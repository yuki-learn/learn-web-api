# 5章 設計変更しやすいWeb APIを作る

Web APIはウェブサービスと同様に公開したら終わりではなく、ずっと公開できるように保守していかねばならない。そのため、APIの変更や廃止などに対応しやすいようなWeb APIを設計する必要がある。


## 設計変更のしやすさの重要性
* **外部に公開しているAPI(LSUDs)**: 急に変更されれば、利用者のアプリケーションはたちまちエラー等で動かなくなり、修正が必要になる。また変更されることを告知するにも一苦労で、やりかたによっては「いきなり仕様変更をする信頼のおけないサービス」と周知されてしまうため扱いが非常に難しい。
* **モバイルアプリケーション向けAPI(SSKDs)**: 外部公開と比べて、自分が作成したアプリに影響するだけなので変更による影響範囲は狭い。<br>
しかし、変更すると利用者側のアプリ更新が必要となる。
* **ウェブサービス上で使っているAPI**: アプリの更新がないのでモバイルアプリケーションより影響範囲は狭い。しかし、キャッシュ問題で不具合が発生する可能性あり。


## APIをバージョンで管理する
最も良い方法は、一度公開したAPIをできる限り変更しないこと。<br>
**複数のバージョンを提供して、新しいAPIを別のエンドポイントや別のパラメータを付けたURIなど、何らかのアクセス形式で公開すれば良い。**<br>
古い形式でアクセスしてきたクライアントには以前と変わらないデータを配信し、新しい形式のアクセスには新しい形式のデータを配信する。

よく使われる方法で、ソフトウェアと同様にバージョン番号を振っていく方法がある。<br>
URIやパラメータでバージョン番号を扱うことで複数バージョンのAPIを共存させる。


### URIにバージョンを埋め込む

TumblrやTwitterのAPIの例
```
Tumblr
http://api.tumblr.com/v2/blog/good.tumblr.com/info

Twitter
https://api.twitter.com/1.1/statuses/user_timeline.json
```
`v2`や`1.1`という部分がバージョン番号。このようにURIのパスの一番先頭に着けるのがバージョン番号をURIに埋め込む方法で一般的であり、最もわかりやすい方法。

`v`をつける、つけないがあるが、`v`をつけたほうがバージョン番号であることが一目瞭然。

### バージョン番号をクエリ文字列に入れる

NetflixやAmazonの例

```uri
Netflix
http://api-public.netflix.com/catalog/titiles/series/70023522?v=1.5

Amazon
http://webservices.amazon.com/onca/xml?Service=AWSECommerceService&Version=2011-08-01
```

URIとの最大の違いは、それが省略可能になるという点。こうしたAPIでは省略したらデフォルトとなるバージョンが設定されている。大抵は省略すると最新版であることが多い。

URIとパスどちらが良いか？ -> **URIのほうが好ましい**<br>
**クエリ文字列は冗長になりやすくパスのほうが簡潔であり、クエリ文字列を省略した場合にどのバージョンを示すのがURIだけでは自明ではないため**